import axios from 'axios';
import { ExploitData } from '../../types/threatIntel';
import { API_CONFIG } from './config';
import { parseCSVLine } from './utils';

export const fetchExploitDBData = async (): Promise<ExploitData[]> => {
  try {
    const response = await axios.get(API_CONFIG.EXPLOITDB.URL);
    return response.data
      .split('\n')
      .slice(1)
      .filter(Boolean)
      .map((line: string) => {
        const [id, file, description, date, author, platform, type] = parseCSVLine(line);
        return {
          id,
          file,
          description,
          date,
          author,
          platform,
          type,
          source: 'ExploitDB'
        };
      });
  } catch (error) {
    console.error('Error fetching ExploitDB data:', error);
    return [];
  }
};