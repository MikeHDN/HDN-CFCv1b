import type { ExploitData } from '../../types/threatIntel';
import { API_CONFIG } from './config';
import { fetchWithRetry } from './utils/network';
import { parseCSVLine } from './utils/parser';

export class ExploitService {
  static async fetchExploits(): Promise<ExploitData[]> {
    try {
      const response = await fetchWithRetry(API_CONFIG.EXPLOITDB.URL);
      return response.data
        .split('\n')
        .slice(1)
        .filter(Boolean)
        .map((line: string) => {
          const [id, file, description, date, author, platform, type] = parseCSVLine(line);
          return { id, file, description, date, author, platform, type, source: 'ExploitDB' };
        });
    } catch (error) {
      console.error('Error fetching exploits:', error);
      return [];
    }
  }
}